#!/usr/bin/zsh

hn=$(hostname)
function my_date () {
    date +"%a %b %d %Y %I:%M:%S"
}
function my_bat() {
    cat /sys/class/power_supply/BAT1/capacity
}

function my_wifi(){
    nmcli | head -n 1 | awk -F ' ' '{print $4}'
}
function wifi_strength() {
    cat /proc/net/wireless | tail -n 1 | awk -F ' ' '{print $3}'
}
function current_window() {
    xpropstr=$(xprop -root _NET_ACTIVE_WINDOW)
    id=("${(@s/ /)xpropstr}")
    $id[-1]
    window=$(xprop -id $id[-1] _NET_WM_NAME)
    wind_name=("${(@s/=/)window}")
    name=$wind_name[-1]
    echo $name[3,-2]

}

function my_load() {
    load=$(uptime)
    average=("${(@s/ /)load}")

    if [[ "$hn" == "k-nine" ]];
    then
        echo "Load: "$average[12,-1]
    else
        echo $average[9,-1]
    fi

}

function updates() {
    updates=$(pacman -Qu | wc -l)
        if [[ $updates -gt 0 ]]
        then
            echo "$updates updates available | "
        fi
}

function my_mail() {
    if [[ $($HOME/bin/mailmon) -gt 0 ]]
    then
        echo "$($HOME/bin/mailmon) emails | "
    fi
}
function my_weather() {
    if [[ $(date +'%M') -eq 0 ]]
    then
        rm $HOME/.config/weather
        $HOME/bin/weather.py > $HOME/.config/weather
    else
        weather=$(cat $HOME/.config/weather)
    fi
    echo $weather
}
if [[ "$hn" == "k-nine" ]];
then
    while; do
        echo "$(my_mail)$(updates)Current Window: $(current_window) | Current Temp: $(my_weather) | $(my_load) | Bat: $(my_bat)% | WIFI: $(my_wifi) $(wifi_strength) $($HOME/bin/tmuxip) | $(my_date)"
        sleep 0.01s
    done
else
    while; do
        echo "$(my_mail)$(updates)Current Window: $(current_window) | Current Temp: $(my_weather) | $(my_load) | WIFI: $(my_wifi) $(wifi_strength) $($HOME/bin/tmuxip) | $(my_date)"
        sleep 0.01s
    done
fi
